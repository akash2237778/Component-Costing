<!DOCTYPE html>
<html lang="en">
<head>
    <title>Sai Precision Quoter</title>
    <script src="https://unpkg.com/htmx.org@1.9.6"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .table-container { overflow-x: auto; }
        input { transition: all 0.2s; }
        input:focus { outline: 2px solid #2563EB; background: #EFF6FF; }
        th:first-child, td:first-child { position: sticky; left: 0; background-color: white; z-index: 10; }
        thead th:first-child { background-color: #1e293b; z-index: 20; }
    </style>
</head>
<body class="bg-gray-100 font-sans h-screen flex flex-col">

   <div class="p-4 bg-white shadow flex justify-between items-center z-30 relative">
        <div class="flex items-center gap-4">
            <h1 class="text-2xl font-bold text-slate-800">PrecisionQuote v1.0</h1>
            <a href="/settings" class="text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 border border-gray-300 px-3 py-1 rounded flex items-center gap-1 transition">
                <span>⚙️ Settings</span>
            </a>
        </div>
        
        <div class="text-sm bg-blue-50 text-blue-800 px-3 py-1 rounded border border-blue-200 hidden md:block">
            <strong>Active Rates:</strong> 
            CNC ₹{{ .Rates.CNCRate }} | 
            Sq ₹{{ .Rates.SquaringRate }} | 
            Wire ₹{{ .Rates.WireCutRate }}
        </div>
    </div>

    <div class="flex-grow p-4 overflow-hidden">
        <div class="bg-white shadow-xl rounded-lg border border-gray-200 table-container h-full overflow-y-auto">
            <table class="min-w-full text-sm border-collapse relative">
                <thead class="bg-slate-800 text-white sticky top-0 z-20 shadow-md">
                    <tr>
                        <th class="p-3 text-left w-48 border-r border-slate-600">Component</th>
                        <th class="p-3 text-left w-32 border-r border-slate-600">Material</th>
                        <th class="p-3 text-center w-20">L (in)</th>
                        <th class="p-3 text-center w-20">W (in)</th>
                        <th class="p-3 text-center w-20 border-r border-slate-600">H (in)</th>
                        <th class="p-3 text-center bg-yellow-600 w-24 text-white font-bold border-r border-yellow-700">Wt (kg)</th>
                        <th class="p-3 text-center bg-yellow-600 w-24 text-white font-bold border-r border-slate-600">Sq Area</th>
                        <th class="p-3 text-center bg-slate-700 w-20">CNC (Hr)</th>
                        <th class="p-3 text-center bg-slate-700 w-20">Wire (mm)</th>
                        <th class="p-3 text-center bg-slate-700 w-20 border-r border-slate-600">Grind (₹)</th>
                        <th class="p-3 text-center w-16 border-r border-slate-600">Qty</th>
                        <th class="p-3 text-right font-bold bg-green-900 w-32 text-white">Total Cost</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    {{ range .Components }}
                    <tr class="hover:bg-gray-50 transition">
                        
                        <td class="p-2 font-medium text-gray-700 border-r shadow-sm">
                            {{ .Name }}
                            <form id="row-form-{{ .ID }}">
                                <input type="hidden" name="component_id" value="{{ .ID }}">
                            </form>
                        </td>
                        
                        <td class="p-1 border-r">
                            <select name="material_id" form="row-form-{{ .ID }}"
                                    hx-post="/calculate" hx-trigger="change" 
                                    hx-include="#row-form-{{ .ID }}" 
                                    hx-target="#cost-val-{{ .ID }}"
                                    class="w-full border rounded p-1 text-xs bg-white">
                                <option value="0" selected>Select...</option>
                                {{ range $.Materials }}
                                <option value="{{ .ID }}">{{ .Name }}</option>
                                {{ end }}
                            </select>
                        </td>

                        <td class="p-1"><input type="number" step="0.1" name="length" placeholder="0" form="row-form-{{ .ID }}" class="w-full border rounded p-1 text-center"
                                   hx-post="/calculate" hx-trigger="keyup delay:400ms changed" hx-include="#row-form-{{ .ID }}" hx-target="#cost-val-{{ .ID }}"></td>
                        <td class="p-1"><input type="number" step="0.1" name="width" placeholder="0" form="row-form-{{ .ID }}" class="w-full border rounded p-1 text-center"
                                   hx-post="/calculate" hx-trigger="keyup delay:400ms changed" hx-include="#row-form-{{ .ID }}" hx-target="#cost-val-{{ .ID }}"></td>
                        <td class="p-1 border-r"><input type="number" step="0.1" name="height" placeholder="0" form="row-form-{{ .ID }}" class="w-full border rounded p-1 text-center"
                                   hx-post="/calculate" hx-trigger="keyup delay:400ms changed" hx-include="#row-form-{{ .ID }}" hx-target="#cost-val-{{ .ID }}"></td>

                        <td class="p-2 text-center text-gray-400 bg-gray-50 font-mono text-xs border-r">
                            <div id="weight-div-{{ .ID }}">-</div>
                        </td>
                        <td class="p-2 text-center text-gray-400 bg-gray-50 font-mono text-xs border-r">
                            <div id="area-div-{{ .ID }}">-</div>
                        </td>

                        <td class="p-1"><input type="number" step="0.5" name="cnc_hours" placeholder="Hrs" form="row-form-{{ .ID }}" class="w-full border rounded p-1 text-center"
                                   hx-post="/calculate" hx-trigger="keyup delay:400ms changed" hx-include="#row-form-{{ .ID }}" hx-target="#cost-val-{{ .ID }}"></td>
                        <td class="p-1"><input type="number" step="1" name="wirecut_len" placeholder="mm" form="row-form-{{ .ID }}" class="w-full border rounded p-1 text-center"
                                   hx-post="/calculate" hx-trigger="keyup delay:400ms changed" hx-include="#row-form-{{ .ID }}" hx-target="#cost-val-{{ .ID }}"></td>
                        <td class="p-1 border-r"><input type="number" step="100" name="grinding_est" placeholder="₹" form="row-form-{{ .ID }}" class="w-full border rounded p-1 text-center"
                                   hx-post="/calculate" hx-trigger="keyup delay:400ms changed" hx-include="#row-form-{{ .ID }}" hx-target="#cost-val-{{ .ID }}"></td>

                        <td class="p-1 border-r"><input type="number" name="quantity" value="1" form="row-form-{{ .ID }}" class="w-full border rounded p-1 text-center font-bold text-blue-600"
                                   hx-post="/calculate" hx-trigger="change, input delay:300ms" hx-include="#row-form-{{ .ID }}" hx-target="#cost-val-{{ .ID }}"></td>

                        <td class="p-3 text-right font-bold text-green-700 bg-green-50 shadow-inner">
                            <span id="cost-val-{{ .ID }}">₹0.00</span>
                        </td>
                    </tr>
                    {{ end }}
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>